# Интеграция HH API для расширения выбора профессий

## Проблема

Ранее система предлагала профессии только из уже сгенерированных карточек (ограниченный список в `data/professions/`). Это ограничивало выбор пользователей, особенно в сценарии "Помоги мне выбрать профессию".

## Решение

Теперь система использует **HH API + LLM** для:
1. Получения актуальных профессий из базы вакансий HeadHunter
2. Умного подбора профессий на основе интересов пользователя через LLM
3. Расширения поиска профессий за пределы локальной базы

## Как это работает

### 1. Сценарий "Помоги мне выбрать профессию"

**Шаг 1:** LLM анализирует диалог и генерирует ключевые слова для поиска в HH API
- Например: `["разработка", "дизайн", "менеджмент", "аналитика"]`

**Шаг 2:** Система запрашивает HH API по каждому ключевому слову
- Получает список профессий с количеством вакансий
- Очищает названия от лишних слов ("в компании X", "- удалённо" и т.д.)

**Шаг 3:** LLM выбирает 3-5 наиболее подходящих профессий из:
- Готовых карточек (приоритет) - если есть подходящие
- Профессий из HH API - если в готовых нет подходящих

**Шаг 4:** Пользователю показываются карточки:
- Если карточка уже существует → показывается сразу
- Если карточка виртуальная (из HH) → будет сгенерирована при клике

### 2. Поиск профессий

При поиске профессии:
1. Сначала проверяется локальная база
2. Если не найдено → поиск в HH API
3. LLM выбирает наиболее релевантные профессии
4. Показываются результаты или запускается генерация новой карточки

## Технические детали

### Функция `fetchProfessionsFromHH`

```typescript
async function fetchProfessionsFromHH(
  keywords: string[],
  limit: number = 20
): Promise<Array<{ name: string; count: number }>>
```

**Что делает:**
- Делает запросы к `https://api.hh.ru/vacancies` для каждого ключевого слова
- Фильтрует только вакансии из России (`area=113`)
- Извлекает и очищает названия профессий из вакансий
- Подсчитывает частоту встречаемости каждой профессии
- Возвращает топ профессий по популярности

**Очистка названий:**
- Убирает скобки `(...)`
- Убирает "в компании X"
- Убирает "- удалённо"
- Берет только первую часть до запятой/слеша

### Функция `suggestProfessionsForUncertainUser` (обновлена)

Теперь включает:
1. Генерацию ключевых слов через LLM
2. Получение профессий из HH API
3. Умный выбор через LLM с приоритетом готовых карточек

### Функция `searchProfessions` (обновлена)

Добавлен fallback на HH API если профессия не найдена локально.

## Преимущества

✅ **Неограниченный выбор** - профессии из реальной базы вакансий  
✅ **Актуальность** - данные синхронизируются с HH  
✅ **Умный подбор** - LLM анализирует интересы и выбирает релевантные профессии  
✅ **Приоритет готовых карточек** - если есть готовая карточка, она показывается первой  
✅ **Генерация по требованию** - виртуальные карточки генерируются при клике  

## Ограничения HH API

- Максимум 10 запросов в секунду с одного IP
- Запросы делаются с User-Agent: `HH-Vibe-Career-App/1.0`
- Фильтрация только по России (`area=113`)

## Примеры использования

### Пример 1: Пользователь выбирает "Помоги мне выбрать"

1. Пользователь отвечает на вопросы о предпочтениях
2. LLM генерирует ключевые слова: `["программирование", "web", "frontend"]`
3. HH API возвращает: `["Frontend-разработчик", "React-разработчик", "Vue-разработчик"]`
4. LLM выбирает наиболее подходящие профессии
5. Показываются карточки (готовые или виртуальные)

### Пример 2: Поиск несуществующей профессии

1. Пользователь ищет "Go-разработчик"
2. Локально не найдено
3. HH API возвращает профессии с "Go" в названии
4. LLM выбирает наиболее релевантные
5. Показываются результаты или запускается генерация

## Логирование

Все операции логируются через `logger`:
- `logger.info('Получены профессии из HH API', ...)`
- `logger.info('Сгенерированы ключевые слова для HH', ...)`
- `logger.info('Подобраны профессии для пользователя', ...)`
- `logger.error('Ошибка запроса к HH API', ...)`

## Будущие улучшения

- [ ] Кеширование результатов HH API
- [ ] Поддержка других регионов (не только Россия)
- [ ] Анализ требований из вакансий для более точного подбора
- [ ] Приоритизация профессий с большим количеством вакансий

